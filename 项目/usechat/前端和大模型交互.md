## 关键交互层面

### 1. Prompt 输入与上下文管理

- 前端通过统一的 `/api/chat` 接口发送请求，携带 `messages`、`model`、`temperature` 等参数；
- 后端拼接系统提示词（system prompt），进行上下文拼接与 token 限制裁剪；
- 使用会话 ID 或用户 ID 维持上下文一致性。

### 2. 流式响应解析与渲染

- 协议：`SSE (Server-Sent Events)` 或 `fetch + ReadableStream`；
- 前端实时读取流数据，结合 `requestAnimationFrame` 批量更新 UI；
- React 层面可结合 `Suspense`、Skeleton 实现平滑流式体验。

### 3. 请求状态与并发控制

- `useChat` Hook 管理 `messages`、`isStreaming`、`error`、`retry`；
- 允许 `controller.abort()` 中断生成；
- 限制同类请求最大并发（如 ≤ 5），防止过载。

### 4. 安全代理与日志追踪

- 前端仅调用后端代理层，避免直接暴露 API Key；
- 后端控制调用频率与 token 限制；
- 每次请求携带 `traceId`，支持链路追踪与埋点。

### 5. 多模态与工具调用

- 支持 `function_call` 结构化输出；
- 前端根据返回类型（text/image/audio）动态渲染组件；

---
